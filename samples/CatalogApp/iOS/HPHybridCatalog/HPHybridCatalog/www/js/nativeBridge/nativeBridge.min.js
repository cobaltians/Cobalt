/* helper object to communicate with native */var nativeBridge={userEvents:{},debug:!1,sendingToNative:!0,callbacks:{},lastCallbackId:0,init:function(e){e&&(e.sendingToNative===!1&&(this.sendingToNative=!1),e.debug===!0&&(this.debug=!0,this.createLogDiv()),e.events&&(this.userEvents=e.events),e.storage===!0&&nativeBridge.initStorage()),nativeBridge.send({type:"nativeBridgeIsReady"})},log:function(e,t){if(nativeBridge.debug){t===undefined&&(t=!0),e=nativeBridge.toString(e);var n=$("#nativeBridge_logdiv");if(n.length)try{n.append("<br/>"+nativeBridge.HTMLEncode(e))}catch(r){n.append("<br/><b>nativeBridge.log failed on something.</b>")}t&&nativeBridge.send({type:"typeLog",value:e})}},createLogDiv:function(){$("#nativeBridge_logdiv").length==0&&($("body").append('<div id="nativeBridge_logdiv" style="position: absolute; top:10px; right: 10px; padding:10px; width:10px; height: 10px; border:1px solid blue; overflow: hidden; "></div>'),$("#nativeBridge_logdiv").on("tap",nativeBridge.toggleLogDiv).on("click",nativeBridge.toggleLogDiv))},toggleLogDiv:function(){$(this).css("width")!="250px"?$(this).css({width:"250px",height:"300px",overflow:"scroll"}):$(this).css({width:"10px",height:"10px",overflow:"hidden"})},send:function(e,t){t&&(typeof t=="function"?(e.callbackID=nativeBridge.lastCallbackId++,nativeBridge.callbacks[e.callbackID]=t):typeof t=="string"&&(e.callbackID=""+t)),nativeBridge.adapter.send(e,t)},sendEvent:function(e,t,n){if(e){var r=t||{};r.type="typeEvent",r.name=e,nativeBridge.send(r,n)}},sendCallback:function(e,t){var n=e;typeof n.callbackID=="string"&&n.callbackID.length>0&&nativeBridge.send({type:"typeCallback",callbackID:n.callbackID,params:t})},navigate:function(e,t,n){switch(e){case"push":t&&nativeBridge.send({type:"typeNavigation",navigationType:"push",navigationPageName:t,navigationClassId:n});break;case"pop":nativeBridge.send({type:"typeNavigation",navigationType:"pop"});break;case"modale":t&&nativeBridge.adapter.navigateToModale(t,n);break;case"dismiss":nativeBridge.adapter.dismissFromModale()}},toast:function(e){nativeBridge.sendEvent("nameToast",{value:nativeBridge.toString(e)})},alert:function(e,t,n,r){if(e||t){var i={type:"typeAlert"},s;t&&(i.alertMessage=t),e&&(i.alertTitle=e),n&&nativeBridge.isArray(n)&&n.length&&(i.alertButtons=n);if(r){if(typeof r.callback=="string"||typeof r.callback=="function")i.alertReceiver="web",s=r.callback;i.alertId=parseInt(r.alertId),r.callbackType==="native"&&(i.alertReceiver="native",s&&nativeBridge.log("warning : alert callback has been set to native, web callback won't be called."),s=undefined),r.mandatory===!0&&(i.alertIsCancelable=!1)}if(!i.alertId||!nativeBridge.isNumber(i.alertId))i.alertId=0;nativeBridge.send(i,s)}},webAlert:function(e,t,n){switch(e){case"dismiss":nativeBridge.send({type:"typeWebAlert",name:"dismiss"});break;case"show":t&&nativeBridge.send({type:"typeWebAlert",name:"show",pageName:t,fadeDuration:n})}},execute:function(e){if(e&&!e.type)try{e=JSON.parse(e)}catch(t){e={}}try{switch(e.type){case"typeEvent":nativeBridge.adapter.handleEvent(e);break;case"typeCallback":nativeBridge.adapter.handleCallback(e);break;case"typeLog":nativeBridge.log("LOG "+decodeURIComponent(e.value),e.logBack);break;default:nativeBridge.log("received unhandled data type : "+e.type)}}catch(t){nativeBridge.log("nativeBridge.execute failed : "+t)}},tryToCallCallback:function(callback){var callbackfunction=null;nativeBridge.isNumber(callback.callbackID)&&typeof nativeBridge.callbacks[callback.callbackID]=="function"?callbackfunction=nativeBridge.callbacks[callback.callbackID]:typeof callback.callbackID=="string"&&(callbackfunction=eval(callback.callbackID));if(typeof callbackfunction=="function")try{callbackfunction(callback.params)}catch(e){nativeBridge.log("Failed calling callback #"+callback.callbackID+".")}},initStorage:function(){return nativeBridge.localStorageEnabled||(nativeBridge.localStorageEnabled=nativeBridge.adapter.initStorage(),nativeBridge.localStorageEnabled||nativeBridge.log("LocalStorage ERROR : localStorage not available !")),nativeBridge.localStorageEnabled},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},toString:function(e){if(typeof e!="string")try{e=JSON.stringify(e)}catch(t){e=""+e}return e},HTMLEncode:function(e){return $("<div/>").text(e||"").html()},HTMLDecode:function(e){return $("<div/>").html(e||"").text()},checkDependency:function(e){switch(e){case"storage":if(!window.utils&&!window.utils.storage)return nativeBridge.log("WARNING : window.utils.storage is not set. it is required for navigate(dismiss) calls"),!1;return nativeBridge.initStorage()}}};nativeBridge.ios_adapter={pipeline:[],pipelineRunning:!1,handleEvent:function(e){nativeBridge.log("<b>received</b> : "+JSON.stringify(e),!1),nativeBridge.userEvents&&typeof nativeBridge.userEvents[e.name]=="function"&&nativeBridge.userEvents[e.name](e)},handleCallback:function(e){switch(e.callbackID){case"callbackSimpleAcquitment":nativeBridge.adapter.unpipe(),nativeBridge.adapter.pipeline.length==0&&(nativeBridge.log("set pipe running=false",!1),nativeBridge.adapter.pipelineRunning=!1);break;default:nativeBridge.tryToCallCallback(e)}},send:function(e){nativeBridge.log("adding to pipe",!1),nativeBridge.adapter.pipeline.push(e),nativeBridge.adapter.pipelineRunning||nativeBridge.adapter.unpipe()},unpipe:function(){nativeBridge.adapter.pipelineRunning=!0;var e=nativeBridge.adapter.pipeline.shift();e&&nativeBridge.sendingToNative&&(nativeBridge.log("----sending : "+JSON.stringify(e),!1),document.location.href=encodeURIComponent("h@ploid#k&y"+JSON.stringify(e)))},navigateToModale:function(e,t){nativeBridge.send({type:"typeNavigation",navigationType:"modale",navigationPageName:e,navigationClassId:t})},dismissFromModale:function(){nativeBridge.send({type:"typeNavigation",navigationType:"dismiss"})},initStorage:function(){return utils.storage.enable()}},nativeBridge.android_adapter={handleEvent:function(e){nativeBridge.log("----received : "+JSON.stringify(e),!1);if(nativeBridge.userEvents&&typeof nativeBridge.userEvents[e.name]=="function")nativeBridge.userEvents[e.name](e);else switch(e.name){case"onBackButtonPressed":nativeBridge.log("sending OK for a native back"),nativeBridge.sendCallback(e,!0)}},handleCallback:function(e){switch(e.callbackID){default:nativeBridge.tryToCallCallback(e)}},send:function(e){if(e&&nativeBridge.sendingToNative){nativeBridge.log("----sending :"+JSON.stringify(e),!1);try{Android.handleMessageSentByJavaScript(JSON.stringify(e))}catch(t){nativeBridge.log("cant connect to native",!1)}}},navigateToModale:function(e,t){nativeBridge.checkDependency("storage")&&nativeBridge.send({type:"typeNavigation",navigationType:"modale",navigationPageName:e,navigationClassId:t,callbackID:"nativeBridge.adapter.storeModaleInformations"})},dismissFromModale:function(){if(nativeBridge.checkDependency("storage")){var e=utils.storage.getItem("dismissInformations","json");e&&e.navigationPageName&&e.navigationClassName?(nativeBridge.send({type:"typeNavigation",navigationType:"dismiss",navigationPageName:e.navigationPageName,navigationClassName:e.navigationClassName}),utils.storage.removeItem("dismissInformations")):nativeBridge.log("dismissInformations are not available in storage")}},storeModaleInformations:function(e){nativeBridge.checkDependency("storage")&&(nativeBridge.log(e,!1),utils.storage.setItem("dismissInformations",e,"json"))},initStorage:function(){try{window.localStorage=LocalStorage}catch(e){nativeBridge.log("LocalStorage ERROR : can't find android class LocalStorage. switching to raw localStorage")}return utils.storage.enable()}},nativeBridge.adapter=nativeBridge.ios_adapter;